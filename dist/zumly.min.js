(()=>{function M(i){if(i!==void 0&&i[0].toLowerCase()==="none")return!0;if(i!==void 0&&i.length>0){let t=s=>[...new Set(s)],e=i.map(s=>s.toLowerCase());return t(e).every(s=>["blur","sepia","saturate"].indexOf(s)!==-1)}}function W(i){var t="",e="";if(i!==void 0)return i.map(s=>{t+=`${s.toLowerCase()==="blur"?"blur(0px) ":s.toLowerCase()==="sepia"?"sepia(0) ":s.toLowerCase()==="saturate"?"saturate(0) ":"none"}`,e+=`${s.toLowerCase()==="blur"?"blur(0.8px) ":s.toLowerCase()==="sepia"?"sepia(5) ":s.toLowerCase()==="saturate"?"saturate(8) ":"none"}`}),[t,e]}function u(i,t,e){i[t]=e}function f(i,t,e,s,n={isRequired:!1,defaultValue:0,allowedValues:0,hasValidation:0,hasAssignFunction:0}){var r=`'${t}' property is required when instance is defined`,a=`'${t}' property has problems`,l=e!==void 0,o=n.defaultValue!==void 0,c=n.hasValidation!==void 0,d=n.hasAssignFunction!==void 0;if(s==="string"||s==="object"||s==="boolean")var m=typeof e===s;else s==="array"&&(m=Array.isArray(e));n.isRequired&&(l&&m?u(i,t,e):v(!1,r,"error")),o&&!c&&!d&&(l&&m?u(i,t,e):e===void 0?u(i,t,n.defaultValue):v(!1,a,"error")),c&&o&&!d&&(l&&m&&n.hasValidation?u(i,t,e):e===void 0?u(i,t,n.defaultValue):v(!1,a,"error")),c&&o&&d&&(l&&m&&n.hasValidation?u(i,t,n.hasAssignFunction):e===void 0?u(i,t,n.defaultValue):v(!1,a,"error"))}function N(i){var t=document.createElement("style");let e=["current-view","previous-view","last-view"],s="";e.map(n=>{s+=`
  .zoom-${n}-${i} {
    animation-name: zoom-${n}-${i};
    animation-duration: var(--zoom-duration-${i});
    animation-timing-function: var(--zoom-ease-${i});
  }
  @keyframes zoom-${n}-${i} {
    0% {
      transform: var(--${n}-transform-start-${i});
    }
    100% {
      transform: var(--${n}-transform-end-${i});
    }
  }
  `}),t.innerHTML=s,document.head.appendChild(t)}function k(i,t,e){let s=t,n=s.views[0],r=s.views[1],a=s.views[2];[{name:"current-view",stage:n},{name:"previous-view",stage:r},{name:"last-view",stage:a}].map(o=>{i==="zoomOut"&&o.stage!==void 0&&(document.documentElement.style.setProperty(`--${o.name}-transform-start-${e}`,o.stage.forwardState.transform),document.documentElement.style.setProperty(`--${o.name}-transform-end-${e}`,o.stage.backwardState.transform),o.name==="current-view"&&(document.documentElement.style.setProperty(`--zoom-duration-${e}`,o.stage.backwardState.duration),document.documentElement.style.setProperty(`--zoom-ease-${e}`,o.stage.backwardState.ease))),i==="zoomIn"&&o.stage!==void 0&&(document.documentElement.style.setProperty(`--${o.name}-transform-start-${e}`,o.stage.backwardState.transform),document.documentElement.style.setProperty(`--${o.name}-transform-end-${e}`,o.stage.forwardState.transform),o.name==="current-view"&&(document.documentElement.style.setProperty(`--zoom-duration-${e}`,o.stage.forwardState.duration),document.documentElement.style.setProperty(`--zoom-ease-${e}`,o.stage.forwardState.ease)))})}async function C(i,t,e,s,n){var r=null;s?r=i:r=i.dataset.to;var a=document.createElement("template");if(typeof e[r]=="object"&&e[r].render!==void 0)a.innerHTML=await e[r].render();else if(typeof e[r]=="function"){var l=document.createElement("div");new e[r]({target:l,context:n,props:i.dataset}),l.classList.add("z-view"),a.content.appendChild(l)}else a.innerHTML=e[r];let o=a.content.querySelector(".z-view");return s?o.classList.add("is-current-view"):(o.classList.add("is-new-current-view"),o.classList.add("has-no-events"),o.classList.add("hide"),o.classList.add("performance")),o.style.transformOrigin="0 0",o.dataset.viewName=r,t.append(a.content),typeof e[r]=="object"&&e[r].mounted!==void 0&&typeof e[r].mounted()=="function"&&await e[r].mounted(),s?t.querySelector(".is-current-view"):t.querySelector(".is-new-current-view")}function v(i,t,e){t&&e==="welcome"&&console.info(`%c Zumly %c ${t}`,"background: #424085; color: white; border-radius: 3px;","color: #424085"),t&&i&&(e==="info"||e===void 0)&&console.info(`%c Zumly %c ${t}`,"background: #6679A3; color: #304157; border-radius: 3px;","color: #6679A3"),t&&e==="warn"&&console.warn(`%c Zumly %c ${t}`,"background: #DCBF53; color: #424085; border-radius: 3px;","color: #424085"),t&&e==="error"&&console.error(`%c Zumly %c ${t}`,"background: #BE4747; color: white; border-radius: 3px;","color: #424085")}function X(i,t){i&&typeof i=="object"?(u(t,"options",!0),f(t,"mount",i.mount,"string",{isRequired:!0}),f(t,"initialView",i.initialView,"string",{isRequired:!0}),f(t,"views",i.views,"object",{isRequired:!0}),f(t,"debug",i.debug,"boolean",{defaultValue:!1}),f(t,"componentContext",i.componentContext,"object",{isRequired:!1,defaultValue:new Map}),i.transitions&&typeof i.transitions=="object"?(f(t,"cover",i.transitions.cover,"string",{defaultValue:"width",hasValidation:()=>{["height","width"].indexOf(i.transitions.cover.toLowerCase())}}),f(t,"duration",i.transitions.duration,"string",{defaultValue:"1s"}),f(t,"ease",i.transitions.ease,"string",{defaultValue:"ease-in-out"}),f(t,"effects",i.transitions.effects,"array",{defaultValue:["none","none"],hasValidation:M(i.transitions.effects),hasAssignFunction:W(i.transitions.effects)})):(u(t,"cover","width"),u(t,"duration","1s"),u(t,"ease","ease-in-out"),u(t,"effects",["none","none"]))):v(!1,"'options' object has to be provided when instance is defined","error")}var x=class i{constructor(t){this.instance=i.counter,this.storedViews=[],this.currentStage=null,this.storedPreviousScale=[1],this.trace=[],this.blockEvents=!1,this.touchstartX=0,this.touchstartY=0,this.touchendX=0,this.touchendY=0,this.touching=!1,X(t,this),this.options?(this._onZoom=this.onZoom.bind(this),this._onZoomInHandlerStart=this.onZoomInHandlerStart.bind(this),this._onZoomInHandlerEnd=this.onZoomInHandlerEnd.bind(this),this._onZoomOutHandlerStart=this.onZoomOutHandlerStart.bind(this),this._onZoomOutHandlerEnd=this.onZoomOutHandlerEnd.bind(this),this._onTouchStart=this.onTouchStart.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this._onKeyUp=this.onKeyUp.bind(this),this._onWeel=this.onWeel.bind(this),this.canvas=document.querySelector(this.mount),this.canvas.setAttribute("tabindex",0),this.canvas.addEventListener("mouseup",this._onZoom,!1),this.canvas.addEventListener("touchend",this._onZoom,!1),this.canvas.addEventListener("touchstart",this._onTouchStart,{passive:!0}),this.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.canvas.addEventListener("keyup",this._onKeyUp,!1),this.canvas.addEventListener("wheel",this._onWeel,{passive:!0})):this.notify("is unable to start: no {options} have been passed to the Zumly's instance.","error")}storeViews(t){this.tracing("storedViews()"),this.storedViews.push(t)}setPreviousScale(t){this.tracing("setPreviousScale()"),this.storedPreviousScale.push(t)}tracing(t){if(this.debug)if(t==="ended"){let e=this.trace.map((s,n)=>`${n===0?`Instance ${this.instance}: ${s}`:`${s}`}`).join(" > ");this.notify(e),this.trace=[]}else this.trace.push(t)}static get counter(){return i._counter=(i._counter||0)+1,i._counter}notify(t,e){return v(this.debug,t,e)}zoomLevel(){return this.storedViews.length}async init(){this.options&&(this.tracing("init()"),N(this.instance),await C(this.initialView,this.canvas,this.views,"init",this.componentContext),this.storeViews({zoomLevel:this.storedViews.length,views:[{viewName:this.initialView,backwardState:{origin:"0 0",transform:""}}]}),this.notify(`${this.instance>1?`instance n\xBA ${this.instance} is active.`:`is running! Instance n\xBA ${this.instance} is active. ${this.debug?"Debug is active, can be deactivate by setting 'debug: false' when you define the instance.":""}
        More tips & docs at https://zumly.org`}`,"welcome"))}async zoomIn(t){this.tracing("zoomIn()");var e=this.instance;let s=this.canvas,n=s.getBoundingClientRect();var r=n.left,a=n.top;let l=this.storedPreviousScale[this.storedPreviousScale.length-1];this.tracing("renderView()");var o=await C(t,s,this.views,!1,this.componentContext);if(o){t.classList.add("zoomed");let h=t.getBoundingClientRect();var c=s.querySelector(".is-current-view"),d=s.querySelector(".is-previous-view"),m=s.querySelector(".is-last-view");m!==null&&s.removeChild(m);let p=o.getBoundingClientRect(),I=p.width/h.width,U=1/I,P=p.height/h.height,K=1/P;var g=t.dataset.withDuration||this.duration,w=t.dataset.withEease||this.ease,G=this.effects[0],J=this.effects[1],O=this.cover;if(O==="width")var y=I,L=U;else O==="height"&&(y=P,L=K);this.setPreviousScale(y);var H=`translate(${h.x-r+(h.width-p.width*L)/2}px, ${h.y-a+(h.height-p.height*L)/2}px) scale(${L})`;o.style.transform=H,c.classList.add("is-previous-view"),c.classList.remove("is-current-view");let $=c.getBoundingClientRect();var Z=c.style.transform;c.style.transformOrigin=`${h.x+h.width/2-$.x}px ${h.y+h.height/2-$.y}px`;let A=n.width/2-h.width/2-h.x+$.x,T=n.height/2-h.height/2-h.y+$.y,R=`translate(${A}px, ${T}px) scale(${y})`;c.style.transform=R;var S=t.getBoundingClientRect(),D=`translate(${S.x-r+(S.width-p.width)/2}px, ${S.y-a+(S.height-p.height)/2}px)`;if(d!==null){d.classList.remove("is-previous-view"),d.classList.add("is-last-view");var _=d.style.transform,z=c.getBoundingClientRect();d.style.transform=`translate(${A-r}px, ${T-a}px) scale(${y*l})`;var E=d.querySelector(".zoomed").getBoundingClientRect();d.style.transform=_,c.style.transform=Z;var q=c.getBoundingClientRect(),F=`translate(${n.width/2-h.width/2-h.x+(q.x-E.x)+z.x-r+(z.width-E.width)/2}px, ${n.height/2-h.height/2-h.y+(q.y-E.y)+z.y-a+(z.height-E.height)/2}px) scale(${y*l})`}else c.style.transform=Z;var b={zoomLevel:this.storedViews.length,views:[]};let V=o?{viewName:o.dataset.viewName,backwardState:{origin:o.style.transformOrigin,duration:g,ease:w,transform:H},forwardState:{origin:o.style.transformOrigin,duration:g,ease:w,transform:D}}:null,Y=c?{viewName:c.dataset.viewName,backwardState:{origin:c.style.transformOrigin,duration:g,ease:w,transform:Z},forwardState:{origin:c.style.transformOrigin,duration:g,ease:w,transform:R}}:null,B=d?{viewName:d.dataset.viewName,backwardState:{origin:d.style.transformOrigin,duration:g,ease:w,transform:_},forwardState:{origin:d.style.transformOrigin,duration:g,ease:w,transform:F}}:null,j=m?{viewName:m}:null;V!==null&&b.views.push(V),Y!==null&&b.views.push(Y),B!==null&&b.views.push(B),j!==null&&b.views.push(j),this.storeViews(b),this.currentStage=this.storedViews[this.storedViews.length-1],this.tracing("setCSSVariables()"),k("zoomIn",this.currentStage,this.instance),c.classList.add("performance"),d!==null&&d.classList.add("performance"),o.classList.remove("hide"),o.addEventListener("animationstart",this._onZoomInHandlerStart),o.addEventListener("animationend",this._onZoomInHandlerEnd),c.addEventListener("animationend",this._onZoomInHandlerEnd),d!==null&&d.addEventListener("animationend",this._onZoomInHandlerEnd),o.classList.add(`zoom-current-view-${e}`),c.classList.add(`zoom-previous-view-${e}`),d!==null&&d.classList.add(`zoom-last-view-${e}`)}}zoomOut(){this.tracing("zoomOut()"),this.blockEvents=!0,this.storedPreviousScale.pop();var t=this.instance;let e=this.canvas;this.currentStage=this.storedViews[this.storedViews.length-1];let s=this.currentStage.views[3];var n=e.querySelector(".is-current-view"),r=e.querySelector(".is-previous-view"),a=e.querySelector(".is-last-view");if(this.tracing("setCSSVariables()"),k("zoomOut",this.currentStage,this.instance),r.querySelector(".zoomed").classList.remove("zoomed"),r.classList.remove("is-previous-view"),r.classList.add("is-current-view"),a!==null&&(a.classList.add("performance"),a.classList.add("is-previous-view"),a.classList.remove("is-last-view"),a.classList.remove("hide")),s!==void 0){e.prepend(s.viewName);var l=e.querySelector(".z-view:first-child");l.classList.add("hide")}n.addEventListener("animationstart",this._onZoomOutHandlerStart),n.addEventListener("animationend",this._onZoomOutHandlerEnd),r.addEventListener("animationend",this._onZoomOutHandlerEnd),a!==null&&a.addEventListener("animationend",this._onZoomOutHandlerEnd),n.classList.add(`zoom-current-view-${t}`),r.classList.add(`zoom-previous-view-${t}`),a!==null&&a.classList.add(`zoom-last-view-${t}`),this.storedViews.pop()}onZoom(t){this.storedViews.length>1&&!this.blockEvents&&!t.target.classList.contains("zoom-me")&&t.target.closest(".is-current-view")===null&&!this.touching&&(this.tracing("onZoom()"),t.stopPropagation(),this.zoomOut()),!this.blockEvents&&t.target.classList.contains("zoom-me")&&!this.touching&&(this.tracing("onZoom()"),t.stopPropagation(),this.zoomIn(t.target))}onKeyUp(t){this.tracing("onKeyUp()"),(t.key==="ArrowLeft"||t.key==="ArrowDown")&&(t.preventDefault(),this.storedViews.length>1&&!this.blockEvents?this.zoomOut():this.notify(`is on level zero. Can't zoom out. Trigger: ${t.key}`,"warn")),(t.key==="ArrowRight"||t.key==="ArrowUp")&&(t.preventDefault(),this.notify(t.key+"has not actions defined"))}onWeel(t){this.blockEvents||(this.tracing("onWeel()"),t.deltaY<0,t.deltaY>0&&this.storedViews.length>1&&!this.blockEvents&&this.zoomOut())}onTouchStart(t){this.tracing("onTouchStart()"),this.touching=!0,this.touchstartX=t.changedTouches[0].screenX,this.touchstartY=t.changedTouches[0].screenY}onTouchEnd(t){this.blockEvents||(this.tracing("onTouchEnd()"),this.touchendX=t.changedTouches[0].screenX,this.touchendY=t.changedTouches[0].screenY,this.handleGesture(t))}handleGesture(t){t.stopPropagation(),this.tracing("handleGesture()"),this.touchendX<this.touchstartX-30&&(this.storedViews.length>1&&!this.blockEvents?(this.tracing("swipe left"),this.zoomOut()):this.notify("is on level zero. Can't zoom out. Trigger: Swipe left","warn")),this.touchendY<this.touchstartY-10&&(this.storedViews.length>1&&!this.blockEvents?this.tracing("swipe up"):this.notify("is on level zero. Can't zoom out. Trigger: Swipe up","warn")),this.touchendY===this.touchstartY&&!this.blockEvents&&t.target.classList.contains("zoom-me")&&this.touching&&(this.touching=!1,this.tracing("tap"),t.preventDefault(),this.zoomIn(t.target)),this.touchendY===this.touchstartY&&this.storedViews.length>1&&!this.blockEvents&&!t.target.classList.contains("zoom-me")&&t.target.closest(".is-current-view")===null&&this.touching&&(this.touching=!1,this.tracing("tap"),this.zoomOut())}onZoomOutHandlerStart(t){this.tracing("onZoomOutHandlerStart()"),this.blockEvents=!0,t.target.removeEventListener("animationstart",this._onZoomOutHandlerStart)}onZoomOutHandlerEnd(t){this.tracing("onZoomOutHandlerEnd()");let e=t.target;var s=this.currentStage;if(e.removeEventListener("animationend",this._onZoomOutHandlerEnd),e.classList.contains(`zoom-current-view-${this.instance}`)){try{this.canvas.removeChild(e)}catch{console.debug("Error when trying to remove element after zoom out. Trying to remove its parent instead...");try{this.canvas.removeChild(e.parentElement)}catch(l){console.debug("Error when trying to remove elemont after zoom out:",l),console.debug("Element to remove was:",e)}}this.blockEvents=!1}if(e.classList.contains(`zoom-previous-view-${this.instance}`)){var n=s.views[1].backwardState.origin,r=s.views[1].backwardState.transform;e.classList.remove("performance"),e.classList.remove(`zoom-previous-view-${this.instance}`),e.style.transformOrigin="0 0",e.style.transform=r,s.views.length===2&&this.tracing("ended")}e.classList.contains(`zoom-last-view-${this.instance}`)&&(n=s.views[2].backwardState.origin,r=s.views[2].backwardState.transform,e.classList.remove("performance"),e.classList.remove(`zoom-last-view-${this.instance}`),e.style.transformOrigin=n,e.style.transform=r,s.views.length>2&&this.tracing("ended"))}onZoomInHandlerStart(t){this.tracing("onZoomInHandlerStart()"),this.blockEvents=!0,t.target.removeEventListener("animationstart",this._onZoomInHandlerStart)}onZoomInHandlerEnd(t){this.tracing("onZoomInHandlerEnd()");let e=t.target;var s=this.currentStage;if(t.target.classList.contains("is-new-current-view")){this.blockEvents=!1;var n="current-view",r=s.views[0].forwardState.transform,a=s.views[0].forwardState.origin;e.classList.remove("is-new-current-view"),e.classList.add("is-current-view")}else t.target.classList.contains("is-previous-view")?(n="previous-view",r=s.views[1].forwardState.transform,a=s.views[1].forwardState.origin,s.views.length===2&&this.tracing("ended")):(n="last-view",r=s.views[2].forwardState.transform,a=s.views[2].forwardState.origin,s.views.length>2&&this.tracing("ended"));e.classList.remove("performance"),e.classList.remove(`zoom-${n}-${this.instance}`),e.classList.remove("has-no-events"),e.style.transformOrigin=a,e.style.transform=r,e.removeEventListener("animationend",this._onZoomInHandlerEnd)}};window.Zumly=x;})();
